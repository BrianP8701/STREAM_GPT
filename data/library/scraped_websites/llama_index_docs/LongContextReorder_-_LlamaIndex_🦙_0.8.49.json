{
    "metadata": {
        "type": "web",
        "url": "https://docs.llamaindex.ai/en/stable/examples/node_postprocessor/LongContextReorder.html",
        "title": "LongContextReorder - LlamaIndex \ud83e\udd99 0.8.49",
        "description": null
    },
    "text": "Toggle table of contents sidebar\n\n## LongContextReorder[\uf0c1](#longcontextreorder \"Permalink to this heading\")\n\nModels struggle to access significant details found in the center of extended contexts. [A study](https://arxiv.org/abs/2307.03172) observed that the best performance typically arises when crucial data is positioned at the start or conclusion of the input context. Additionally, as the input context lengthens, performance drops notably, even in models designed for long contexts.\n\nThis module will re-order the retrieved nodes, which can be helpful in cases where a large top-k is needed.\n\n## Setup[\uf0c1](#setup \"Permalink to this heading\")\n\nimport os\nimport openai\n\nos.environ\\[\"OPENAI\\_API\\_KEY\"\\] \\= \"sk-...\"\nopenai.api\\_key \\= os.environ\\[\"OPENAI\\_API\\_KEY\"\\]\n\nfrom llama\\_index import ServiceContext\nfrom llama\\_index.llms import OpenAI\n\nllm \\= OpenAI(model\\=\"gpt-3.5-turbo-instruct\", temperature\\=0.1)\nctx \\= ServiceContext.from\\_defaults(\n    llm\\=llm, embed\\_model\\=\"local:BAAI/bge-base-en-v1.5\"\n)\n\n/home/loganm/miniconda3/envs/llama-index/lib/python3.11/site-packages/torch/cuda/\\_\\_init\\_\\_.py:546: UserWarning: Can't initialize NVML\n  warnings.warn(\"Can't initialize NVML\")\n\nfrom llama\\_index import SimpleDirectoryReader\n\ndocuments \\= SimpleDirectoryReader(\"../data/paul\\_graham/\").load\\_data()\n\nfrom llama\\_index import VectorStoreIndex\n\nindex \\= VectorStoreIndex.from\\_documents(documents, service\\_context\\=ctx)\n\n## Run Query[\uf0c1](#run-query \"Permalink to this heading\")\n\nfrom llama\\_index.indices.postprocessor import LongContextReorder\n\nreorder \\= LongContextReorder()\n\nreorder\\_engine \\= index.as\\_query\\_engine(\n    node\\_postprocessors\\=\\[reorder\\], similarity\\_top\\_k\\=5\n)\nbase\\_engine \\= index.as\\_query\\_engine(similarity\\_top\\_k\\=5)\n\nfrom llama\\_index.response.notebook\\_utils import display\\_response\n\nbase\\_response \\= base\\_engine.query(\"Did the author meet Sam Altman?\")\ndisplay\\_response(base\\_response)\n\n**`Final Response:`** Yes, the author met Sam Altman when they asked him to be the president of Y Combinator. This was during the time when the author was in a PhD program in computer science and also pursuing their passion for art. They were applying to art schools and eventually ended up attending RISD.\n\nreorder\\_response \\= reorder\\_engine.query(\"Did the author meet Sam Altman?\")\ndisplay\\_response(reorder\\_response)\n\n**`Final Response:`** Yes, the author met Sam Altman when they asked him to be the president of Y Combinator. This meeting occurred at a party at the author\u2019s house, where they were introduced by a mutual friend, Jessica Livingston. Jessica later went on to compile a book of interviews with startup founders, and the author shared their thoughts on the flaws of venture capital with her during her job search at a Boston VC firm.\n\n## Inspect Order Diffrences[\uf0c1](#inspect-order-diffrences \"Permalink to this heading\")\n\nprint(base\\_response.get\\_formatted\\_sources())\n\n\\> Source (Doc id: 81bc66bb-2c45-4697-9f08-9f848bd78b12): \\[17\\]\n\nAs well as HN, I wrote all of YC's internal software in Arc. But while I continued to work ...\n\n> Source (Doc id: bd660905-e4e0-4d02-a113-e3810b59c5d1): \\[19\\] One way to get more precise about the concept of invented vs discovered is to talk about spa...\n\n> Source (Doc id: 3932e4a4-f17e-4dd2-9d25-5f0e65910dc5): Not so much because it was badly written as because the problem is so convoluted. When you're wor...\n\n> Source (Doc id: 0d801f0a-4a99-475d-aa7c-ad5d601947ea): \\[10\\]\n\nWow, I thought, there's an audience. If I write something and put it on the web, anyone can...\n\n> Source (Doc id: bf726802-4d0d-4ee5-ab2e-ffa8a5461bc4): I was briefly tempted, but they were so slow by present standards; what was the point? No one els...\n\nprint(reorder\\_response.get\\_formatted\\_sources())\n\n\\> Source (Doc id: 81bc66bb-2c45-4697-9f08-9f848bd78b12): \\[17\\]\n\nAs well as HN, I wrote all of YC's internal software in Arc. But while I continued to work ...\n\n> Source (Doc id: 3932e4a4-f17e-4dd2-9d25-5f0e65910dc5): Not so much because it was badly written as because the problem is so convoluted. When you're wor...\n\n> Source (Doc id: bf726802-4d0d-4ee5-ab2e-ffa8a5461bc4): I was briefly tempted, but they were so slow by present standards; what was the point? No one els...\n\n> Source (Doc id: 0d801f0a-4a99-475d-aa7c-ad5d601947ea): \\[10\\]\n\nWow, I thought, there's an audience. If I write something and put it on the web, anyone can...\n\n> Source (Doc id: bd660905-e4e0-4d02-a113-e3810b59c5d1): \\[19\\] One way to get more precise about the concept of invented vs discovered is to talk about spa..."
}