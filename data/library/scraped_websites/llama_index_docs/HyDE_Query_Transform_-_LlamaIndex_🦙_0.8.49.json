{
    "metadata": {
        "type": "web",
        "url": "https://docs.llamaindex.ai/en/stable/examples/query_transformations/HyDEQueryTransformDemo.html",
        "title": "HyDE Query Transform - LlamaIndex \ud83e\udd99 0.8.49",
        "description": null
    },
    "text": "[Back to top](#)\n\nToggle table of contents sidebar\n\n## HyDE Query Transform[\uf0c1](#hyde-query-transform \"Permalink to this heading\")\n\n## Load documents, build the VectorStoreIndex[\uf0c1](#load-documents-build-the-vectorstoreindex \"Permalink to this heading\")\n\nimport logging\nimport sys\n\nlogging.basicConfig(stream\\=sys.stdout, level\\=logging.INFO)\nlogging.getLogger().addHandler(logging.StreamHandler(stream\\=sys.stdout))\n\nfrom llama\\_index import VectorStoreIndex, SimpleDirectoryReader\nfrom llama\\_index.indices.query.query\\_transform import HyDEQueryTransform\nfrom llama\\_index.query\\_engine.transform\\_query\\_engine import (\n    TransformQueryEngine,\n)\nfrom IPython.display import Markdown, display\n\n\\# load documents\ndocuments \\= SimpleDirectoryReader(\"../paul\\_graham\\_essay/data\").load\\_data()\n\nindex \\= VectorStoreIndex.from\\_documents(documents)\n\n## Example: HyDE improves specific temporal queries[\uf0c1](#example-hyde-improves-specific-temporal-queries \"Permalink to this heading\")\n\nquery\\_str \\= \"what did paul graham do after going to RISD\"\n\n### First, we query _without_ transformation: The same query string is used for embedding lookup and also summarization.[\uf0c1](#first-we-query-without-transformation-the-same-query-string-is-used-for-embedding-lookup-and-also-summarization \"Permalink to this heading\")\n\nquery\\_engine \\= index.as\\_query\\_engine()\nresponse \\= query\\_engine.query(query\\_str)\ndisplay(Markdown(f\"<b>{response}</b>\"))\n\n> After going to RISD, Paul Graham continued to pursue his passion for painting and art. He took classes in the painting department at the Accademia di Belli Arti in Florence, and he also took the entrance exam for the school. He also continued to work on his book On Lisp, and he took on consulting work to make money. At the school, Paul Graham and the other students had an arrangement where the faculty wouldn\u2019t require the students to learn anything, and in return the students wouldn\u2019t require the faculty to teach anything. Paul Graham was one of the few students who actually painted the nude model that was provided, while the rest of the students spent their time chatting or occasionally trying to imitate things they\u2019d seen in American art magazines. The model turned out to live just down the street from Paul Graham, and she made a living from a combination of modelling and making fakes for a local antique dealer.\n\n### Now, we use `HyDEQueryTransform` to generate a hypothetical document and use it for embedding lookup.[\uf0c1](#now-we-use-hydequerytransform-to-generate-a-hypothetical-document-and-use-it-for-embedding-lookup \"Permalink to this heading\")\n\nhyde \\= HyDEQueryTransform(include\\_original\\=True)\nhyde\\_query\\_engine \\= TransformQueryEngine(query\\_engine, hyde)\nresponse \\= hyde\\_query\\_engine.query(query\\_str)\ndisplay(Markdown(f\"<b>{response}</b>\"))\n\n> After going to RISD, Paul Graham worked as a consultant for Interleaf and then co-founded Viaweb with Robert Morris. They created a software that allowed users to build websites via the web and received $10,000 in seed funding from Idelle\u2019s husband Julian. They gave Julian 10% of the company in return for the initial legal work and business advice. Paul Graham had a negative net worth due to taxes he owed, so the seed funding was necessary for him to live on. They opened for business in January 1996 with 6 stores.\n\n> Paul Graham then left Yahoo after his options vested and went back to New York. He resumed his old life, but now he was rich. He tried to paint, but he didn\u2019t have much energy or ambition. He eventually moved back to Cambridge and started working on a web app for making web apps. He recruited Dan Giffin and two undergrads to help him, but he eventually realized he didn\u2019t want to run a company and decided to build a subset of the project as an open source project. He and Dan worked on a new dialect of Lisp, which he called Arc, in a house he bought in Cambridge. The subset he built as an open source project was the new Lisp, whose\n\n### In this example, `HyDE` improves output quality significantly, by hallucinating accurately what Paul Graham did after RISD (see below), and thus improving the embedding quality, and final output.[\uf0c1](#in-this-example-hyde-improves-output-quality-significantly-by-hallucinating-accurately-what-paul-graham-did-after-risd-see-below-and-thus-improving-the-embedding-quality-and-final-output \"Permalink to this heading\")\n\nquery\\_bundle \\= hyde(query\\_str)\nhyde\\_doc \\= query\\_bundle.embedding\\_strs\\[0\\]\n\n> After graduating from the Rhode Island School of Design (RISD) in 1985, Paul Graham went on to pursue a career in computer programming. He worked as a software developer for several companies, including Viaweb, which he co-founded in 1995. Viaweb was eventually acquired by Yahoo in 1998, and Graham used the proceeds to become a venture capitalist. He founded Y Combinator in 2005, a startup accelerator that has helped launch over 2,000 companies, including Dropbox, Airbnb, and Reddit. Graham has also written several books on programming and startups, and he continues to be an active investor in the tech industry.\n\n## Failure case 1: HyDE may mislead when query can be mis-interpreted without context.[\uf0c1](#failure-case-1-hyde-may-mislead-when-query-can-be-mis-interpreted-without-context \"Permalink to this heading\")\n\nquery\\_str \\= \"What is Bel?\"\n\n### Querying without transformation yields reasonable answer[\uf0c1](#querying-without-transformation-yields-reasonable-answer \"Permalink to this heading\")\n\nresponse \\= query\\_engine.query(query\\_str)\ndisplay(Markdown(f\"<b>{response}</b>\"))\n\n> Bel is a programming language that was written in Arc by Paul Graham over the course of four years (March 26, 2015 to October 12, 2019). It is based on John McCarthy\u2019s original Lisp, but with additional features added. It is a spec expressed as code, and is meant to be a formal model of computation, an alternative to the Turing machine.\n\n#### Querying with `HyDEQueryTransform` results in nonsense[\uf0c1](#querying-with-hydequerytransform-results-in-nonsense \"Permalink to this heading\")\n\nhyde \\= HyDEQueryTransform(include\\_original\\=True)\nhyde\\_query\\_engine \\= TransformQueryEngine(query\\_engine, hyde)\nresponse \\= hyde\\_query\\_engine.query(query\\_str)\ndisplay(Markdown(f\"<b>{response}</b>\"))\n\n> Bel is the pseudonym of Paul Graham, the author of the context information who was in need of seed funding to live on and was part of a deal that became the model for Y Combinator\u2019s.\n\n#### In this example, `HyDE` mis-interprets Bel without document context (see below), resulting in a completely unrelated embedding string and poor retrieval outcome.[\uf0c1](#in-this-example-hyde-mis-interprets-bel-without-document-context-see-below-resulting-in-a-completely-unrelated-embedding-string-and-poor-retrieval-outcome \"Permalink to this heading\")\n\nquery\\_bundle \\= hyde(query\\_str)\nhyde\\_doc \\= query\\_bundle.embedding\\_strs\\[0\\]\n\n> Bel is an ancient Semitic god, originating from the Middle East. He is often associated with the sun and is sometimes referred to as the \u201cLord of Heaven\u201d. Bel is also known as the god of fertility, abundance, and prosperity. He is often depicted as a bull or a man with a bull\u2019s head. In some cultures, Bel is seen as a creator god, responsible for the creation of the universe. He is also associated with the underworld and is sometimes seen as a god of death. Bel is also associated with justice and is often seen as a protector of the innocent. Bel is an important figure in many religions, including Judaism, Christianity, and Islam.\n\n## Failure case 2: HyDE may bias open-ended queries[\uf0c1](#failure-case-2-hyde-may-bias-open-ended-queries \"Permalink to this heading\")\n\nquery\\_str \\= \"What would the author say about art vs. engineering?\"\n\n### Querying without transformation yields a reasonable answer[\uf0c1](#querying-without-transformation-yields-a-reasonable-answer \"Permalink to this heading\")\n\nresponse \\= query\\_engine.query(query\\_str)\ndisplay(Markdown(f\"<b>{response}</b>\"))\n\n> The author would likely say that art and engineering are two different disciplines that require different skills and approaches. Art is more focused on expression and creativity, while engineering is more focused on problem-solving and technical knowledge. The author also suggests that art school does not always provide the same level of rigor as engineering school, and that painting students are often encouraged to develop a signature style rather than learn the fundamentals of painting. Furthermore, the author would likely point out that engineering can provide more financial stability than art, as evidenced by the author\u2019s own experience of needing seed funding to live on while launching a company.\n\n### Querying with `HyDEQueryTransform` results in a more biased output[\uf0c1](#querying-with-hydequerytransform-results-in-a-more-biased-output \"Permalink to this heading\")\n\nresponse \\= hyde\\_query\\_engine.query(query\\_str)\ndisplay(Markdown(f\"<b>{response}</b>\"))\n\n> The author would likely say that art is a more lasting and independent form of work than engineering. They mention that software written today will be obsolete in a couple decades, and that systems work does not last. In contrast, they note that paintings can last hundreds of years and that it is possible to make a living as an artist. They also mention that as an artist, you can be truly independent and don\u2019t need to have a boss or research funding. Furthermore, they note that art can be a source of income for people who may not have access to traditional forms of employment, such as the model in the example who was able to make a living from modelling and making fakes for a local antique dealer."
}